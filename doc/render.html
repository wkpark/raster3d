<html>
<head>
<title> render - Raster3D package </title>
</head>
<body>

<h1 align=center>
<a name="RTFToC11">RENDER</a></h1>
<h4>
<a name="RTFToC12">SYNOPSIS</a></h4>
render is the central image rendering program of the 
<a href="raster3d.html"> Raster3D </a> 
molecular graphics package

<listing>
render [-tiff outfile.tiff] [-sgi outfile.rgb] [-original] &lt; input.r3d &gt; outfile
</listing>
Render
reads an ascii file consisting of several header lines followed by individual
object descriptors. The objects are rendered using a fast Z-buffer algorithm to
produce a high quality pixel image which contains two light sources, specular
highlighting, Phong shaded surfaces, and shadows. Output is to stdout [or
optional file] in the form of a pixel image with 24 bits of color information
per pixel. The default output file format is an AVS image file. Support for
TIFF or SGI libimage image files may be optionally included during installation
of the Raster3D package.<p>
Several utility programs exist which will create all or part of an acceptable
input file by reading atomic coordinates from a Brookhaven PDB file. These
include 
<a href="balls.html">balls</a>, 
<a href="rods.html">rods</a>, and 
<a href="ribbon.html">ribbon</a> 
from the Raster3D distribution kit, and
Molscript [Per Kraulis (1991) J. Appl. Cryst. 24, 946-950].<p>
Black&white half-toned PostScript output may be obtained by filtering the
output stream from render through the utility program
<a href="avs2ps.html">avs2ps</a>.
<h4>
<a name="RTFToC13">EXAMPLES</a></h4>
Render a simple space-filling model coloured by residue type:

<listing>
cat mycolors.pdb protein.pdb | balls | render &gt; mypicture.avs
</listing>
Display
the same picture on an X-windows display directly using ImageMagick:

<listing>
cat mycolors.pdb protein.pdb | balls | render | display avs:-
</listing>
Render
and display the same picture using the SGI libimage format:

<listing>
cat mycolors.pdb protein.pdb | balls | render -sgi picture.rgb 
ipaste picture.rgb
</listing>
Render
a stick-figure model of a cofactor jointly with a ribbon model of a protein.
Note that the header records are generated by the ribbon command in this case;
the -h flag suppresses generation of a second set of header records in the rods
command. The ImageMagick convert command is used to save the resulting image as
a TIFF file.

<listing>
ribbon -d4 protein.pdb &gt; ribbon.r3d 
cat colors.pdb cofactor.pdb | rods -bs -h &gt; cofactor.r3d 
cat ribbon.r3d cofactor.r3d | render | convert avs:- picture.tiff
</listing>
If
TIFF support has been built directly into Raster3D, then the previous command
can be modified to produce a TIFF file without conversion:

<listing>
cat ribbon.r3d cofactor.r3d | render -tiff picture.tiff
</listing>
<h4>OPTIONS</h4>
<dl>
<dt><i>-tiff filename</i><dd>Only if compiled with -DTIFF_SUPPORT. By default
render will produce an AVS-compatible image on stdout. The -tiff flag will
cause it to output a TIFF image to the specified file instead.
<dt><i> -sgi filename</i><dd>Only if compiled with -DLIBIMAGE_SUPPORT. By
default render will produce an AVS-compatible image on stdout. The -sgi flag
will cause it to output an SGI libimage style *.rgb file instead. In this case
default output is to the file render.rgb, but specifying a file on the command
line will override this default.
<dt><i> -original</i><dd>This flag causes render to produce an output image
compatible with some earlier versions of the Raster3D package. Output is to
stdout.</dl><h4>
<a name="RTFToC14">DESCRIPTION</a></h4>
The input to render consists of a single text file containing everything
necessary to prepare the image of a scene consisting of coloured spheres,
cylinders and triangles. The header records contain information global to the
scene being rendered. The header records are followed by individual object
records containing coordinate and color specification for the objects in the
scene. The surface shading of primitive objects (spheres, cylinders, and simple
triangles) is calculated analytically. Sequential triangles forming a
ribbon-like chain are rendered by a more complex algorithm which produces the
appearance of a a smoothly-shaded surface rather than a faceted one [ref:
Merritt &amp; Murphy].
<h4>
<a name="RTFToC15">HEADER
RECORDS
</a></h4>
The required header records of a render input file are described below. Except
where noted, each item is on a line by itself in free format. The names are of
variables in the program source code.
<dl>
<dt><b><i></i></b></dl><dl>
<dt><i>TITLE</i><dd>Anything you like, up to 80 characters.
<dt><i>NTX,NTY</i><dd>Number of ``tiles'' in each direction. (The output
display is considered to be divided up into an array of identical rectangular
tiles.) The maximum is 192 unless you have increased MAXNTX and MAXNTY in
render.f.
<dt><i>NPX,NPY</i><dd>Number of computing pixels per tile in each direction.
Maximum = 36 (MAXNPX, MAXNPY in render.f)
<dt><i>SCHEME</i><dd>Pixel averaging (anti-aliasing) scheme (1, 2, or 3), where 
<br>	1 means 1 computing pixel for 1 output pixel 
<br>	2 means 2x2 computing pixels for 1 output pixel 
<br>	3 means 3x3 computing pixels for 2x2 output pixels
<br>(i.e. scheme 1 produces a NTX*NPX by NTY*NPY pixel image, scheme 3 produces
a (2/3)NTX*NPX by (2/3)NTY*NPY image). Increased anti-aliasing (schemes 2 or 3)
produces a scene in which objects have less jagged edges, at the cost of
additional computation. 
<br>Note that scheme 3 requires that NPX and NPY be multiples of 3.
<dt><i>BKGND</i><dd>Background colour (red, green, and blue components, each in
the range 0 to 1).
<dt><i>SHADOW</i><dd>T to calculate shadowing within the scene, F to omit
shadows
<dt><i>IPHONG</i><dd>Phong power (e.g., 25) for specular highlights. A smaller
value results in a larger spot.
<br>IPHONG = 0 disables specular highlighting and all processing of ribbon
triangles
<dt><i>STRAIT</i><dd>Straight-on (secondary) light source contribution (e.g.,
0.15). The primary light source contribution (see also SOURCE below) is given
by PRIMAR = 1 - STRAIT.
<dt><i>AMBIEN</i><dd>Ambient illumination contribution (e.g., 0.05). Increasing
the ambient light will reduce the contrast between shadowed and non-shadowed
regions.
<dt><i>SPECLR</i><dd>Specular reflection contribution (e.g., 0.25). 
<br>The diffuse reflection quantity is given by DIFFUS = 1 - (AMBIEN+SPECLR).
Ambient and diffuse reflections are chromatic, taking on the specified colour
of each object, whereas specular reflections are white.
<dt><i>EYEPOS</i><dd>You can think of the image produced by render as
corresponding to a photograph taken by a camera placed a certain distance away
from the objects making up the scene. This distance is controlled by the EYEPOS
parameter. EYEPOS = 4 describes a perspective corresponding to a viewing
distance 4 times the narrow dimension of the described scene. A very large
value of EYEPOS will yield a scene with essentially no parallax or perspective.
<dt><i>SOURCE</i><dd>Primary light source position (e.g., 1 1 1). This is a
white light point source at infinite distance in the direction of the vector
given (see note on co-ordinate convention below). The secondary light source is
always head-on. Only the primary light source casts shadows.
<dt><i>TMAT </i><dd>Homogeneous global transformation for input objects, given
as a 4x4 matrix on 4 lines just as you would write it if you intended it to be
a postfix (suffix) operator. The upper left 3x3 submatrix expresses a pure
rotation, the lower left 1x3 submatrix gives a translation, the upper right 3x1
submatrix should be zero (otherwise extra perspective is introduced), and the
lower right scalar (h) produces global scaling. Note that the scale factor h
ends up being applied as an inverse; i.e. a larger value of h will result in
shrinking the objects in the picture. Input coordinate vectors [x&nbsp; y&nbsp;
z] are extended with a 1 to make them homogeneous, and then post-multiplied by
the entire matrix; i.e. [x' y' z' h'] = [x y z 1][TMAT], then the ultimate
co-ordinates are [x'' y'' z''] = (1/h')[x' y' z'].
<dt><i>INMODE</i><dd>Object input mode (1, 2, or 3), where mode 1 means that
all objects are triangles, mode 2 means that all objects are spheres, and mode
3 means that each object will be preceded by a record containing a single
number indicating its type. The Raster3D programs use only mode 3. 
<br>	type 1 = triangle 
<br>	type 2 = sphere 
<br>	type 3 = round-ended cylinder 
<br>	type 5 = flat-ended cylinder 
<br>	type 6 = plane (triangle with infinite extent)
<br>	type 7 = explicit surface normals at vertices of previous triangle
<br>	type 8 = explicit material properties for subsequent objects
<br>	type 9 = terminate previous explicit material properties
<br>	type 0 = end of input file
<dt><i>INFMT or INFMTS</i><dd>Object input format specifier(s). For object
input modes 1 and 2, there is just one format specifier INFMT for the
corresponding object type, while for mode 3, there are three format specifiers
INFMTS on three lines. The first describes the format for a triangle, the
second for a sphere, and the third for a cylinder. Each format specifier is
either a Fortran format enclosed in parentheses, or a single asterisk to
indicate free-format input. Parameters are read in the order
    <dl>	
    <dt><i>triangle or plane (object types 1 or 6):</i>
    <dd>x1, y1, z1, x2, y2, z2, x3, y3, z3, red, green, blue
    <dt><i>sphere (object type 2):</i>
    <dd>x, y, z, radius, red, green, blue
    <dt><i>cylinder (object type 3 or 5):</i>
    <dd>x1, y1, z1, R1, x2, y2, z2, R2, red, green, blue
    (R1 is the cylinder radius, R2 is currently ignored).
    </dl>
</dl>

<h4>Additional object types added in Version 2.1</h4>
Version 2.1 of Raster3D added support for a few new object types.
These are intended to provide additional flexibility in adapting other
molecular graphics tools to compose figures for Raster3D to render.

<dl>
<dt>Object type 7
<dd>Explicit vertex normals for preceeding triangle object. This object 
    must directly follow the triangle object, and uses the same format.
    The intended use of this object type is to allow rendering of
    arbitrary molecular surfaces.
<dt>Object type 8
<dd>Material properties. These values override the specification of
    lighting and specular highlighting in the header records, allowing
    some objects to have different surface properties from the rest.
    The specified values will apply to all subsequent objects until
    an object of type 9 is encountered.  The parameters are read as
    free format floating point numbers from the following line:
    <ul>
    <li>MPHONG - override global Phong parameter for specular highlighting
    <li>MSPEC - override global specular scattering contribution
    <li>SR,SG,SB - RGB triple specifying color of reflected light
        (by default all specular highlights are white).
	A negative value for any colour component defaults to the corresponding
	base colour component of the object being rendered.
    <li>CLRITY - (floating point value between 0.0 and 1.0) The degree of 
	transparency for this material, with 0.0 indicating an
	opaque surface and 1.0 indicating a purely transparent one.
    <li>OPTS(4) - four additional fields are reserved for future expansion
	of the material properties list; as of now these must be
	present, but are ignored.
    </ul>
<dt>Object type 9
<dd>Terminates previous set of special material properties.
    The rest of this record is ignored, so object type 9 may also
    be used as a comment record.
</dl>

<h4> <a name="RTFToC16">SAMPLE HEADER </a></h4>

<pre>
My picture. (describes a 1280 x 1024 pixel anti-aliased image) 
80 64 	  tiles in x,y 24 24 pixels (x,y) per tile 
3 	  anti-aliasing level 3; 3x3-&gt;2x2 
0 0 0 	  black background 
F 	  no shadows cast 
25 	  Phong power 
0.25 	  secondary light contribution 
0.05 	  ambient light contribution 
0.25 	  specular reflection component 
4.0 	  eye position 
1 1 1 	  main light source position (from over right shoulder) 
1 0 0 0   view matrix describing input coordinate transformation 
0 1 0 0 
0 0 1 0 
0 0 0 0.6 no translation; enlarge objects in picture by 66% (1/.6)
3 	  mixed objects 
* 	 (free format triangle and plane descriptors) 
* 	 (free format sphere descriptors) 
* 	 (free format cylinder descriptors)

</pre>
<h4>
<a name="RTFToC17">SAMPLE
INPUT DATA FOLLOWING HEADER
</a></h4>
The following records describe a single red triangle and a single blue sphere

<pre>
1
-.1 0. 0.     .1 0. 0.     0. -.2 0.5         1.0 0.0 0.0
2
0.3 0.3 0.0         0.1                       0.0 0.0 1.0
0
</pre>

<a name="arrays">
<h4>INCREASING THE ARRAY SIZES IN RENDER:</h4>
</a>
If you are creating images of very large proteins, or if you are rendering
surfaces with many facets, then you may fill the storage arrays in render.
If so you will get an error message something like
<listing>
	STOP 1234 **** too many objects - increase MAXOBJ and recompile
</listing>
The parameters which you may need to increase are contained in the 
following lines of <i>render.f</i>:
<listing>
*     Maximum number of objects (was 7500)
      PARAMETER (MAXOBJ = 25000)
*
*     Array elements available for object details
      PARAMETER (MAXDET = 250 000, MAXSDT = 250 000)
*
*     Array elements available for sorted lists ("short" lists)
      PARAMETER (MAXSHR = 150 000, MAXSSL = 150 000)
</listing>
You can use the 
<a href="normal3d.html">normal3d</a> 
utility to calculate how many objects and object
details are needed for your picture.  The sorted list sizes are harder to
calculate in advance, but the render program itself should indicate how much
space would be required to complete a picture which it cannot currently
handle.<p>

Increase the appropriate PARAMETER values by editing <i>render.f</i>, and
recompile the render program by typing "make render".
<p>


<h4>
<a name="RTFToC18">AUTHORS</a></h4>
Originally written by David J. Bacon. Extensions, revisions, and modifications
by Ethan A Merritt.

<hr>
<a href="raster3d.html">
<img src="/images/index_button.gif" align=top> Back to top </a>
<a href="http://www.bmsc.washington.edu/raster3d/raster3d.html">
<img src="r3d_icon.gif" alt="" align=top> Raster3D homepage </a>

</body>
</html>
