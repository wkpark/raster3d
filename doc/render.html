<html>
<head>
<title> render - Raster3D package </title>
</head>
<body>

<h1 align=center>RENDER</h1>

<h4> SYNOPSIS</h4>
render is the central image rendering program of the 
<a href="raster3d.html"> Raster3D </a> 
molecular graphics package.<br>
Usage:

<listing>
     render [-invert]                     < input.r3d > outfile.avs
or
     render [-invert] [-quality NN] -jpeg < input.r3d > outfile.jpeg
or
     render [-invert] -tiff outfile.tiff  < input.r3d
or
     render [-invert] -sgi outfile.rgb    < input.r3d
or
     render [-invert] -out outfile.xxx    < input.r3d
</listing>

Render
reads an ascii file consisting of several header lines followed by individual
object descriptors. The objects are rendered using a fast Z-buffer algorithm to
produce a high quality pixel image which contains one shadowing light source, 
additional non-shadowing light sources, specular highlighting, transparency,
and Phong shaded surfaces. Output is to stdout [or
optional file] in the form of a pixel image with 24 bits of color information
per pixel. The default output file format is an AVS image sent to stdout. 
Support for JPEG, TIFF or SGI libimage image files may be optionally included 
during installation of the Raster3D package.
Additional output formats are possible by using the -out option if ImageMagick 
is installed also.

<p>
There are several utility programs that will create all or part of an acceptable
input file by reading atomic coordinates from a Brookhaven PDB file. These
include 
<a href="balls.html">balls</a>, 
<a href="rastep.html">rastep</a>, 
<a href="rods.html">rods</a>, and 
<a href="ribbon.html">ribbon</a> 
from the Raster3D distribution kit, and
Molscript [Per Kraulis (1991) J. Appl. Cryst. 24, 946-950].<p>

<hr>
<center>
<table cellpadding=5>
<tr>
<th colspan=3>
<b>More information on render</b>
</th>
</tr>
<tr>
<td><a href="#examples">Examples</a> </td>
<td><a href="#options">Options</a> </td>
<td><a href="#description">Description</a> </td>
<td><a href="#header">Header Records</a> </td>
</tr>
<tr>
<td><a href="#sample_header">Sample Header</a> </td>
<td><a href="#objects">Object Types</a> </td>
<td><a href="#comments">Comments</a> </td>
<td><a href="#indirection">File Indirection</a> </td>
</tr>
<tr>
<td><a href="#sample_data">Sample Data Stream</a> </td>
<td><a href="#errors">Error Messages</a> </td>
<td><a href="#arrays">Increasing Array Sizes</a> </td>
</tr>
<tr>
<td><a href="#authors">Authors</a> </td>
</tr>
</table>
</center>
<hr>


<h4>
<a name="examples">EXAMPLES</a></h4>
Render a simple space-filling model coloured by residue type:

<listing>
    cat mycolors.pdb protein.pdb | balls | render &gt; mypicture.avs
</listing>
Display
the same picture on an X-windows display directly using ImageMagick:

<listing>
    cat mycolors.pdb protein.pdb | balls | render | display avs:-
</listing>
Render
and display the same picture using the SGI libimage format:

<listing>
    cat mycolors.pdb protein.pdb | balls | render -sgi picture.rgb 
    ipaste picture.rgb
</listing>
Render
a stick-figure model of a cofactor jointly with a ribbon model of a protein.
Note that the header records are generated by the ribbon command in this case;
the -h flag suppresses generation of a second set of header records in the rods
command. The ImageMagick convert command is used to save the resulting image as
a TIFF file.

<listing>
    ribbon -d4 protein.pdb &gt; ribbon.r3d 
    cat colors.pdb cofactor.pdb | rods -bs -h &gt; cofactor.r3d 
    cat ribbon.r3d cofactor.r3d | render | convert avs:- picture.tiff
</listing>
If
TIFF support has been built directly into Raster3D, then the previous command
can be modified to produce a TIFF file without conversion:

<listing>
    cat ribbon.r3d cofactor.r3d | render -tiff picture.tiff
</listing>

<h4><a name="options">OPTIONS</a></h4>
<dl>
    <dt><i> -invert</i>
    <dd>Invert the image top-to-bottom. This could be necessary
	if you are using some odd viewing program.
    <dt><i> -quality NN</i>
    <dd>Only meaningful in conjunction with the -jpeg option;
	sets the output image quality parameter. Allowable values range from 1-100 (default = 90).
    <dt><i>-jpeg </i>
    <dd>Only if compiled with -DJPEG_SUPPORT. By default
	render will produce an AVS-compatible image on stdout. The -jpeg flag will
	cause it to output a JPEG image stream to stdout instead.
    <dt><i>-tiff filename.tiff</i>
    <dd>Only if compiled with -DTIFF_SUPPORT.
	The -tiff flag will cause render to output a TIFF image to the specified file.
    <dt><i> -sgi [filename.rgb]</i>
    <dd>Only if compiled with -DLIBIMAGE_SUPPORT.  The -sgi flag
	will cause render to output an SGI libimage style *.rgb file instead. In this case
	default output is to the file render.rgb, but specifying a file on the command
	line will override this default.
    <dt><i> -out filename.xxx</i>
    <dd>Only if compiled with -DIMAGEPIPE. The -out flag will cause render to pipe output to the 
	ImageMagick command convert, with instructions to convert it to an image file whose type is 
	determined by the filename extension xxx. 

    <dt><i> -original</i>
    <dd>This flag causes render to produce an output image
	compatible with some earlier versions of the Raster3D package. Output is to
	stdout.
</dl>

<h4><a name="description">DESCRIPTION</a></h4>
The input to render consists of a single text file containing everything
necessary to prepare the image of a scene consisting of coloured spheres,
cylinders and triangles. The header records contain information global to the
scene being rendered. The header records are followed by individual object
records containing coordinate and color specification for the objects in the
scene. The surface shading of primitive objects (spheres, cylinders, and simple
triangles) is calculated analytically. Sequential triangles forming a
ribbon-like chain are rendered by a more complex algorithm which produces the
appearance of a a smoothly-shaded surface rather than a faceted one [ref:
Merritt &amp; Murphy].
<h4>
<a name="header">HEADER RECORDS </a></h4>
The required header records of a render input file are described below. Except
where noted, each item is on a line by itself in free format. The names are of
variables in the program source code.
<dl>
<dt><b><i></i></b></dl><dl>
<dt><i>TITLE</i><dd>Anything you like, up to 80 characters.
<dt><i>NTX,NTY</i><dd>Number of ``tiles'' in each direction. (The output
display is considered to be divided up into an array of identical rectangular
tiles.) The maximum is 192 unless you have increased MAXNTX and MAXNTY in
render.f.
<dt><i>NPX,NPY</i><dd>Number of computing pixels per tile in each direction.
Maximum = 36 (MAXNPX, MAXNPY in render.f)
<dt><i>SCHEME</i><dd>Pixel averaging (anti-aliasing) scheme.
Anti-aliasing reduces the jaggedness of edges at the cost of additional 
computation. If you are going to matte your images against an externally 
generated background, use scheme 0 (matting and anti-aliasing do not mix well).
<br>
<dl>
    <dt> Scheme 0
    <dd> no anti-aliasing, include alpha blend (matte) channel in 
	output image
    <dt> Scheme 1
    <dd> no anti-aliasing, no matted channel
    <dt> Scheme 2
    <dd> anti-alias by averaging 2x2 computing pixels for each 
	output pixel 
    <dt> Scheme 3
    <dd> anti-alias by averaging 3x3 computing pixels for each
	2x2 output pixels (obsolete - use scheme 4 instead)
    <dt> Scheme 4
    <dd> anti-alias as in scheme 3, but header specifies <i>final</i> 
	raster size rather than <i>computing</i> raster size
</dl>
<br>
(i.e. schemes 0, 1, and 4 produce a NTX*NPX by NTY*NPY pixel image; 
scheme 3 produces a (2/3)NTX*NPX by (2/3)NTY*NPY image). 
Scheme 3 requires that NPX and NPY be divisible by 3.
Schemes 2 and 4 require that NPX and NPY be divisible by 2.
<br>Images can be previewed using scheme 1 for greater speed, and re-rendered 
with anti-aliasing scheme 4 with no change in the output image size. No changes
to NTX, NTY, NPX, NPY are required in this case.

<dt><i>BKGND</i><dd>Background colour (red, green, and blue components, each in
the range 0 to 1).
<dt><i>SHADOW</i><dd>T to calculate shadowing within the scene, F to omit
shadows
<dt><i>IPHONG</i><dd>Phong power (e.g., 25) for specular highlights. A smaller
value results in a larger spot.
<br>IPHONG = 0 disables specular highlighting and all processing of ribbon
triangles
<dt><i>STRAIT</i><dd>Straight-on (secondary) light source contribution (e.g.,
0.15). The primary light source contribution (see also SOURCE below) is given
by PRIMAR = 1 - STRAIT.
<dt><i>AMBIEN</i><dd>Ambient illumination contribution (e.g., 0.05). Increasing
the ambient light will reduce the contrast between shadowed and non-shadowed
regions.
<dt><i>SPECLR</i><dd>Specular reflection contribution (e.g., 0.25). 
<br>The diffuse reflection quantity is given by DIFFUS = 1 - (AMBIEN+SPECLR).
Ambient and diffuse reflections are chromatic, taking on the specified colour
of each object, whereas specular reflections are white.
<dt><i>EYEPOS</i><dd>You can think of the image produced by render as
corresponding to a photograph taken by a camera placed a certain distance away
from the objects making up the scene. This distance is controlled by the EYEPOS
parameter. EYEPOS = 4 describes a perspective corresponding to a viewing 
distance 4 times the narrow dimension of the described scene.
EYEPOS = 0 disables perspective.
<dt><i>SOURCE</i><dd>Primary light source position (e.g., 1 1 1). This is a
white light point source at infinite distance in the direction of the vector
given (see note on co-ordinate convention below). The secondary light source is
always head-on. Only the primary light source casts shadows.
<dt><i>TMAT </i><dd>Homogeneous global transformation for input objects, given
as a 4x4 matrix on 4 lines just as you would write it if you intended it to be
a postfix (suffix) operator. The upper left 3x3 submatrix expresses a pure
rotation, the lower left 1x3 submatrix gives a translation, the upper right 3x1
submatrix should be zero (otherwise extra perspective is introduced), and the
lower right scalar (h) produces global scaling. Note that the scale factor h
ends up being applied as an inverse; i.e. a larger value of h will result in
shrinking the objects in the picture. Input coordinate vectors [x&nbsp; y&nbsp;
z] are extended with a 1 to make them homogeneous, and then post-multiplied by
the entire matrix; i.e. [x' y' z' h'] = [x y z 1][TMAT], then the ultimate
co-ordinates are [x'' y'' z''] = (1/h')[x' y' z'].
<dt><i>INMODE</i><dd>Object input mode (1, 2, or 3), where mode 1 means that
all objects are triangles, mode 2 means that all objects are spheres, and mode
3 means that each object will be preceded by a record containing a single
number indicating its type. The Raster3D programs use only mode 3. 
<dt><i>INFMT or INFMTS</i><dd>Object input format specifier(s). For object
input modes 1 and 2, there is just one format specifier INFMT for the
corresponding object type, while for mode 3, there are three format specifiers
INFMTS on three lines. The first describes the format for a triangle, the
second for a sphere, and the third for a cylinder. Each format specifier is
either a Fortran format enclosed in parentheses, or a single asterisk to
indicate free-format input.
</dl>

<h4> <a name="sample_header">SAMPLE HEADER </a></h4>

<pre>
My picture. (describes a 1280 x 1024 pixel anti-aliased image) 
80 64 	  tiles in x,y 
16 16     pixels (x,y) per tile 
4 	  anti-aliasing level 4; 3x3-&gt;2x2 
0 0 0 	  black background 
F 	  no shadows cast 
25 	  Phong power 
0.25 	  secondary light contribution 
0.05 	  ambient light contribution 
0.25 	  specular reflection component 
4.0 	  eye position 
1 1 1 	  main light source position (from over right shoulder) 
1 0 0 0   view matrix describing input coordinate transformation 
0 1 0 0 
0 0 1 0 
0 0 0 0.6 no translation; enlarge objects in picture by 66% (1/.6)
3 	  mixed objects 
* 	 (free format triangle and plane descriptors) 
* 	 (free format sphere descriptors) 
* 	 (free format cylinder descriptors)

</pre>


<h4>
<a name="objects">OBJECT TYPES</a></h4>
<dl>

<dt> Object type 1	
<dt><font color=#BB2222>triangle</font>
    <dd> x1, y1, z1, x2, y2, z2, x3, y3, z3, red, green, blue
    <p>

<dt> Object type 2	
<dt><font color=#BB2222>sphere</font>
    <dd> x, y, z, radius, red, green, blue 
    <p>

<dt> Object type 3	
<dt><font color=#BB2222>round-ended cylinder</font>
    <dd> x1, y1, z1, R1, x2, y2, z2, R2, red, green, blue<br>
    (R1 is the cylinder radius, R2 is currently ignored).
    <p>

<dt> Object type 4	
<dt><font color=#BB2222>not used</font>
    <dd>
    <p>

<dt> Object type 5	
<dt><font color=#BB2222>flat-ended cylinder</font>
    <dd> x1, y1, z1, R1, x2, y2, z2, R2, red, green, blue<br>
    (R1 is the cylinder radius, R2 is currently ignored).
    <p>

<dt> Object type 6	
<dt><font color=#BB2222>plane</font>
    <dd> x1, y1, z1, x2, y2, z2, x3, y3, z3, red, green, blue
    <p>

<dt> Object type 7	
<dt><font color=#BB2222>explicit surface normals at vertices of preceding triangle</font>
    <dd> u1, v1, w1, u2, v2, w2, u3, v3, w3<br>
     Explicit vertex normals for preceding triangle object. This object must
     directly follow the triangle object (see also object type 17). The
     intended use of this object type is to allow description of arbitrary
     molecular surfaces in terms of a triangular mesh. 
    <p>

<dt> Object type 8	
<dt><font color=#BB2222>material properties</font>
    <dd> These values override the specification of lighting and specular
     highlighting in the header records, allowing some objects to have
     different surface properties from the rest. The specified values will
     apply to all subsequent objects until an object of type 9 is
     encountered. The parameters are read in free format from the next
     line of the input stream:
     <dl>
     <dt> MPHONG
	<dd>override global Phong parameter for specular highlighting

     <dt>MSPEC 
	<dd>override global specular scattering contribution

     <dt>SR,SG,SB 	
        <dd>RGB triple specifying color of reflected light (by default
	all reflections are white), a negative value for any component will
	default to the base colour component of the object being rendered

	
     <dt>CLRITY
        <dd>(floating point value between 0.0 and 1.0) The degree of
	transparency for this material; 0.0 indicates an opaque surface and 1.0
	indicates a purely transparent one.

     <dt>OPTS(4)
        <dd>four additional fields are reserved for future expansion of
	the material properties list; these must be present. The first field
	controls alternative algorithms for rendering transparent objects:
	<dl>
	<dd>OPT(1) = 0 render self-occluding portions of a transparent material separately
	<dd>OPT(1) = 1 render only the ``top'' surface of transparent material
	</dl>
        The last field is non-zero to signal that additional modifier
	records will follow immediately. Each modifier record must constitute a
	single line, and OPT(4) states how many of these there will be. For example
	<dl>
	<dd>OPT(4) = 2 means that the next two lines contain additional material modifiers
	</dl>

     <dt>Object type 8 modifiers<br>
	Additional modifiers to MATERIAL descriptors (type 8) are now supported.
	Each modifier record must constitute a single line of input, and the
	total number of such modifier lines must be specified in the final
	parameter of the MATERIAL record. Modifiers currently supported include
	SOLID and BACKFACE records, as shown in the following example of a 2-
	sided material that is solid red on one side and solid blue on the other
	side:

<listing>
# Here is an example of specifying a double sided material
# The MATERIAL record itself specifies an opaque material with PHONG
# value to 25 and specular parameters taken from the header records,
# and says that there are two following modifer lines.
# The SOLID modifier gives an RGB color triple that over-rides colors on
# subsequent objects.
# The BACKFACE modifier specifies a separate RGB color for the other side 
# of this material, and sets the Phong control parameter and specular
# component of this surface to zero (i.e. it's a matte blue surface).
8
20. -1.   1. 1. 1.   0.0    0 0 0 2
SOLID     1.0 0.0 0.0
BACKFACE  0.3 0.3 1.0   0 0
</listing>
Here is the complete list of modifiers currently available, and their parameters
<listing>
    SOLID       RED GREEN BLUE
    BACKFACE    RED GREEN BLUE MPHONG MSPEC
    FRONTCLIP   ZFRONT
</listing>
    </dl>

<dt> Object type 9	
<dt><font color=#BB2222>terminate special properties</font>
<dd> Terminates previous set of special material properties (object type
     8) or isolation from TMAT transformation (object type 15). The rest of
     this record is ignored, so object type 9 may also be used as a comment
     record. It is preferable, however, to begin pure comments with '#' 
     rather than '9'.
     <p>

<dt> Object types 10-12
<dt><font color=#BB2222>Label descriptors</font>
<dd>
Version 2.3 introduced preliminary support for labels in a render input
file. This has been substantially upgraded in version 2.4j.
Object types 10, 11, and 12 are used to specify labels. 
The current implementation of label handling is not done in render,
however, but rather in a separate program called 
<a href="r3dtops.html">r3dtops</a>.  The executable shell script 
<a href="label3d.html">label3d</a> will automatically feed an input 
file containing labels through render, r3dtops, ghostscript and ImageMagick
to yield a final image containing both the renderered molecular 
graphics objects and the specified labels. 
Here is an example:
<pre>
        # Force the label coordinates to be interpreted as screen coords
        # (obviously you wouldn't do this if you want the label to get the
        # same translation/rotation/scaling as other objects do)
        15
        # Choose a font
        10
        "Times-Italic" 12. "Center-align"
        # specifiy a label 
        11
        0.0 0.45 0.0       1.0 0.0 0.0
        I am a red title centered at the top of the image
        # Terminate isolation from coordinate transformation
        9
</pre>

      <dl>
	<dt> Object type 10
	<dd> "Font specifier" size  "alignment"<br>
	     Legal fonts specifiers are subject to the details of label processing implementation.
	     In the context of label3d/r3dtops/ghostscript processing, <br>
	     fontname is any PostScript font name recogized by ghostscript,<br>
	     size is the font size in points (assuming eventual printing at 300 dpi),<br>
	     alignment is either "Right-align", "Left-align", or "Center-align" 
	     (only the first character is checked).<br>
	     The default is "Times-Bold" 10 "Left-align".
	     <p>
	
	<dt> Object type 11
	<dd> [XYZ] [RGB]<br>
	     Label text
	     <p>
	
	<dt> Object type 12
	<dd> reserved (single line of text)
	     <p>

	<dt>
	    (If you are developing a higher-level application that will pass
	    labels to Raster3D for rendering, please contact me so that we can make
	    sure the protocols are compatible <i>-EAM</i>). 
     </dl>
     <p>

<dt> Object type 13	
<dt><font color=#BB2222>Glow light source</font>
<dd> This is a colored, non-shadowing, light source with
     finite [x y z] coordinates and a limited range of illumination. Control
     parameters are read in free format from a single line of input following
     the line specifying the object type.
     <dl>
	<dt>GLOWSRC(3)		
		<dd>[x y z] coordinates of light source

	<dt>GLOWRAD		
		<dd>limiting radius of light source (see GOPT)

	<dt>GLOW		
		<dd>fractional contribution (0.0 - 1.0) of glow light to total lighting model

	<dt>GOPT		
		<dd>(integer 0/1/2/3/...) - controls functional form in which 
		limiting radius is applied [under development]

	<dt>GPHONG		
		<dd>Phong parameter controlling specular highlights from glow light source

	<dt>GLOWCOL(3)		
		<dd>RGB triple specifying color of glow light source
     </dl>
     <p>

<dt> Object type 14	
<dt><font color=#BB2222>quadric surface</font>
<dd> x, y, z, limiting_radius, red, green, blue, A, B, C, D, E, F, G, H, I, J
<br>
Quadric surfaces include spheres, cones, ellipsoids, paraboloids, and
hyperboloids.  The motivation for this code was to allow rendering
thermal ellipsoids for atoms, so the other shapes have not been
extensively tested. A quadric surface is described by 10 parameters (A
... J). Although these parameters are sufficient to describe a quadric
surface located anywhere, for efficiency during rendering it is also
useful to know the center and a bounding sphere. So by convention we
require that (A...J) describe a surface centered at the origin, and add
additional parameters x, y, z to add a translation component. Therefore
a quadric surface descriptor to render has the 17 parameters listed above.
<p>
The surface itself is the set of points for which Q(x,y,z) = 0 where 
<dl>
    <dt>Q(x,y,z) =  Ax<sup>2</sup> +  By<sup>2</sup> +  Cz<sup>2</sup> + 2Dxy + 2Eyz + 2Fzx + 2Gx   + 2Hy   + 2Iz +  J
</dl>
<p>
Points further from the origin (prior to translation!) than the 
limiting radius are not rendered.
<p>

<dt> Object type 15	
<dt><font color=#BB2222>begin isolation from TMAT transformation</font>
<dd> Objects following this descriptor are interpreted as being in an
     absolute coordinate system centered at the origin and having unit extent
     in X, Y, and Z.  If the image is square, the coordinates run from
     -0.5 to +0.5 on both X and Y. If the image is rectangular, coordinates 
     run from -0.5 to +0.5 on the shorter dimension.
     The rotation and translation described by the TMAT
     matrix is not applied. This isolation from TMAT applies to subsequent
     objects until an object of type 9 is encountered.
     <p>

<dt> Object type 16
<dt><font color=#BB2222>Global properties</font>
<dd> Object type 16 is always followed by a single record that affects the rendering
    of the entire scene. The only global properties supported at the moment
    are listed below.
    FOG allows depth-cueing using either a linear or an exponential
    model of fog density. A record simply consisting of the keyword FOG will
    produce reasonable depth-cueing (linear decrease in intensity front closest
    object to farthest object). If you need to control the depth-cueing indepently
    from the specific rendered objects in a scene (i.e. to keep the depth-cueing
    consistent between frames of an animation) then you should specify explicit
    values for fogfront, fogback and fogden.
    <p>
<pre>FOG        fogtype fogfront fogback fogden</pre>
	<DL>
	<DT>fogtype</DT>
	<DD>0 = linear multiplier = fogden * (fogfront - Z) / (fogfront - fogback)</DD>
	<DD>1 = exponential multiplier = 1. - exp( -fogden * (fogfront - Z) / (fogfront - fogback) )</DD>
	
	<DT>fogfront</DT>
	<DD>0 = Z coord of front object, else fraction of front clipping plane</DD>
	<DT>fogback</DT>
	<DD>0 = Z coord of back object, else fraction of rear clipping plane</DD>
	
	<DT>fogden</DT>
	<DD>(see equations for linear and exponential models controlled by fogtype);
	    fogden=0.0 will default to some reasonable value</DD>
	
	</DL>
    <p>
<pre>BACKCLIP   zback</pre>
	<DL>
	<DT>zback</DT>
	<DD>Z coord of rear clipping plane for all objects; in original units
	    of original coordinate system, but relative to the center of the
	    transformed coordinate system. </DD>
	</DL>
<pre>FRONTCLIP  zfront</pre>
	<DL>
	<DT>zfront</DT>
	<DD>Z coord of front clipping plane for all objects; in original units
	    of original coordinate system, but relative to the center of the
	    transformed coordinate system. </DD>
	</DL>
    <p>


<dt> Object type 17	
<dt><font color=#BB2222>explicit coloring at vertices of preceding triangle or cylinder</font>
<dd> R1 G1 B1   R2 G2 B2   R3 G3 B3<br>
     Normally a triangle is colored uniformly in the color specified by the
     RGB triple in the TRIANGLE record itself. Using this additional object,
     however, you can specify a separate color for each vertex of the triangle.
     Points in the interior of the triangle are colored by interpolation using
     the vertex colors. This is commonly used in conjunction with explicit
     vertex normals (object type 7) to describe a smooth surface in terms of a
     triangular mesh.  In this case the component triangles of the surface are
     described by three successive objects of types 1, 7, and 17.
     (The ordering 1, 17, 7 is also acceptable).
     <p>
     As of version 2.4j this mechanism may also be used to interpolate colors
     along the length of a cylinder. In this case the third RGB triple is ignored.
     <p>

<dt> Object type 0	
<dt><font color=#BB2222>force end of input stream (optional)</font>
<dd> Further records in input file will not be read. 
     <p>

</dl>

<a name="comments">
<h4>COMMENTS</h4> 
</a>
At any point in the input stream to render where an object descriptor would be legal, it is also legal to insert a line beginning with the `#' character. In this case the line is ignored, and may be used as a comment. Earlier versions of the program recommended using object type 9 as a comment delimiter, but this has the potential disadvantage of prematurely terminating the scope of a special material.


<a name="indirection">
<h4>FILE INDIRECTION</h4>
</a>
At any point in the input stream to render where an object descriptor
would be legal, it is also legal to insert a line beginning with `@'. In
this case the remainder of the line is interpreted as the name of a file
from which further input is taken. This mechanism makes it possible to
re-use standard objects in multiple rendered scenes, e.g. a set of
bounding planes or standard definitions of material properties. When
input from this level of file indirection is terminated by encountering
an object descriptor of type 0, control returns to the previous input
stream. Multiple levels of file indirection are possible.
<p>
The requested file is first searched for relative to the current directory.
If this search fails, the file is searched for relative to the directory
specified by the environmental variable R3D_LIB.
Typically this would be set via a command such as
<pre>
	setenv R3D_LIB /usr/local/src/raster3d/materials
</pre>


<h4>
<a name="sample_data">
SAMPLE INPUT DATA FOLLOWING HEADER
</a>
</h4>
The following records describe a single red triangle and a single blue sphere.
The blue sphere is affected by whatever material descriptor is in the file
material1.r3d

<pre>
1
-.1 0. 0.     .1 0. 0.     0. -.2 0.5         1.0 0.0 0.0
@material1.r3d
2
0.3 0.3 0.0         0.1                       0.0 0.0 1.0
9 End material1
0
</pre>

<a name="errors">
<h4>ERROR MESSAGES</h4>
</a>
<dl>
<dt><b><i>Possible shadowing error NSXMAX = xxx </i></b>
    <dd>
    This is usually caused by an object which extends far out of
    the field of view, for example a plane surface. In most cases the
    shadowing "error" refers to a shadow which lies outside of the image
    entirely.  However, if your image does in fact contain missing or
    truncated shadows you can overcome this problem by re-compiling the
    render program with larger values of NSX and NSY as indicated by the
    error message.
</dl>


<a name="arrays">
<h4>INCREASING THE ARRAY SIZES IN RENDER:</h4>
</a>
If you are creating images of very large proteins, or if you are rendering
surfaces with many facets, then you may fill the storage arrays in render.
If so you will get an error message something like
<listing>
	STOP 1234 **** too many objects - increase MAXOBJ and recompile
</listing>
The parameters which you may need to increase are contained in the 
following lines of <i>render.f</i>:
<listing>
*     Maximum number of objects (was 7500)
      PARAMETER (MAXOBJ = 25000)
*
*     Array elements available for object details
      PARAMETER (MAXDET = 250 000, MAXSDT = 250 000)
*
*     Array elements available for sorted lists ("short" lists)
      PARAMETER (MAXSHR = 150 000, MAXSSL = 150 000)
</listing>
You can use the 
<a href="normal3d.html">normal3d</a> 
utility to calculate how many objects and object
details are needed for your picture.  The sorted list sizes are harder to
calculate in advance, but the render program itself should indicate how much
space would be required to complete a picture which it cannot currently
handle.<p>

Increase the appropriate PARAMETER values by editing <i>render.f</i>, and
recompile the render program by typing "make render".
<p>


<h4>
<a name="authors">AUTHORS</a></h4>
Originally written by David J. Bacon. Extensions, revisions, and modifications
by Ethan A Merritt.

<hr>
<a href="raster3d.html">
<img src="/images/index_button.gif" align=top> Back to top </a>
<a href="http://www.bmsc.washington.edu/raster3d/raster3d.html">
<img src="r3d_icon.gif" alt="" align=top> Raster3D homepage </a>

</body>
</html>
